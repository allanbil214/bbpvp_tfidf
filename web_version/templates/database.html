{% extends "base.html" %}

{% block title %}Database Configuration - BBPVP{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">
        <i class="fas fa-database text-primary me-3"></i>
        Database Configuration
    </h1>
    <p class="page-subtitle">Configure MySQL database connection settings</p>
</div>

<div class="row g-4">
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header">
                <i class="fas fa-cog me-2"></i>
                Connection Settings
            </div>
            <div class="card-body">
                <form id="dbConfigForm">
                    <div class="mb-3">
                        <label class="form-label fw-bold">
                            <i class="fas fa-server me-2"></i>
                            Host
                        </label>
                        <input type="text" class="form-control" id="dbHost" 
                               value="{{ db_config.host }}" placeholder="localhost">
                        <small class="text-muted">MySQL server hostname or IP address</small>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">
                            <i class="fas fa-plug me-2"></i>
                            Port
                        </label>
                        <input type="number" class="form-control" id="dbPort" 
                               value="{{ db_config.port }}" placeholder="3307">
                        <small class="text-muted">MySQL server port (usually 3306 or 3307)</small>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">
                            <i class="fas fa-database me-2"></i>
                            Database Name
                        </label>
                        <input type="text" class="form-control" id="dbName" 
                               value="{{ db_config.database }}" placeholder="bbpvp_thesis">
                        <small class="text-muted">Name of the database to use</small>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">
                            <i class="fas fa-user me-2"></i>
                            Username
                        </label>
                        <input type="text" class="form-control" id="dbUser" 
                               value="{{ db_config.user }}" placeholder="root">
                        <small class="text-muted">MySQL username</small>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">
                            <i class="fas fa-key me-2"></i>
                            Password
                        </label>
                        <div class="input-group">
                            <input type="password" class="form-control" id="dbPassword" 
                                   value="{{ db_config.password }}" placeholder="Enter password">
                            <button class="btn btn-outline-secondary" type="button" id="togglePassword">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <small class="text-muted">MySQL password (leave empty if no password)</small>
                    </div>
                    
                    <div class="d-grid gap-2">
                        <button type="button" class="btn btn-primary btn-lg" id="btnTestConnection">
                            <i class="fas fa-plug me-2"></i>
                            Test Connection
                        </button>
                        <button type="button" class="btn btn-success" id="btnSaveConfig">
                            <i class="fas fa-save me-2"></i>
                            Save Configuration
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        {% include 'partials/database_instructions.html' %}
    </div>
    
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span>
                    <i class="fas fa-signal me-2"></i>
                    Connection Status
                </span>
                <span class="badge bg-secondary" id="statusBadge">Not Tested</span>
            </div>
            <div class="card-body">
                <div id="statusDisplay" class="text-center text-muted py-5">
                    <i class="fas fa-plug fa-3x mb-3 opacity-50"></i>
                    <p>Click "Test Connection" to check database connectivity</p>
                </div>
            </div>
        </div>
        
        <div class="card mt-4">
            <div class="card-header">
                <i class="fas fa-terminal me-2"></i>
                Connection Logs
            </div>
            <div class="card-body">
                <div id="connectionLogs" style="max-height: 400px; overflow-y: auto; 
                     background: #f8fafc; border-radius: 0.5rem; padding: 1rem; 
                     font-family: 'Courier New', monospace; font-size: 0.85rem;">
                    <div class="text-muted">
                        <i class="fas fa-info-circle me-2"></i>
                        Connection logs will appear here...
                    </div>
                </div>
            </div>
        </div>
        
        {% include 'partials/database_troubleshooting.html' %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/database.js') }}"></script>
{% endblock %}